# =============================================================================
# PROTECTED SERVICES CONFIGURATION
# =============================================================================
# Dynamic values come from global (passed via Application valuesObject)

# =============================================================================
# OAuth2-Proxy Integration (deployed separately via helm chart)
# =============================================================================
oauth2Proxy:
  authUrl: "http://oauth2-proxy.oauth2-proxy.svc.cluster.local/oauth2/auth"
  authSignin: "https://$host/oauth2/start?rd=$escaped_request_uri"
  authResponseHeaders: "X-Auth-Request-User,X-Auth-Request-Email,X-Auth-Request-Groups"

# =============================================================================
# Services to protect via Tailscale + NGINX Ingress + OAuth2-Proxy
# =============================================================================
services:
  argocd:
    enabled: true
    namespace: argocd
    allowedGroups:
      - infra-admins
      - argocd-admins
    backend:
      name: argocd-server
      port: 80

  longhorn:
    enabled: true
    namespace: longhorn-system
    allowedGroups:
      - infra-admins
      - longhorn-admins
    backend:
      name: longhorn-frontend
      port: 80

  grafana:
    enabled: true
    namespace: monitoring
    allowedGroups:
      - infra-admins
      - monitoring-admins
    backend:
      name: kube-prometheus-stack-grafana
      port: 80

  # =============================================================================
  # DEV Services (Tailscale only, oauth2: false disables OAuth2-Proxy)
  # =============================================================================
  example-api-dev:
    enabled: true
    oauth2: false
    namespace: example-api-dev
    backend:
      name: example-api-dev
      port: 8080

  example-ui-dev:
    enabled: true
    oauth2: false
    namespace: example-ui-dev
    backend:
      name: example-ui-dev
      port: 8080

  # =============================================================================
  # PRD Services - Public via Cloudflare Tunnel + NGINX Ingress
  # =============================================================================
  example-api-prd:
    enabled: true
    oauth2: false
    tailscale: false
    cloudflare: true
    cloudflareHost: "api.untrustedonline.org"
    namespace: example-api-prd
    backend:
      name: example-api-prd
      port: 8080

  example-ui-prd:
    enabled: true
    oauth2: false
    tailscale: false
    cloudflare: true
    cloudflareHost: "untrustedonline.org"
    namespace: example-ui-prd
    backend:
      name: example-ui-prd
      port: 8080
